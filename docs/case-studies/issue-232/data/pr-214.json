{"body":"## Summary\n- Fix input processing order to detect MMB presses on first reload attempt\n- Initialize MMB tracking flag based on current state instead of unconditionally resetting\n- Add diagnostic logging flag for debugging similar issues\n\n## Problem\nAfter opening the bolt (RMB drag UP) and trying to load a shell (MMB + RMB drag DOWN) for the **first time**, the bolt closes instead of loading a shell. Subsequent attempts work correctly.\n\n**Original (Russian):** \"После открытия затвора и попытки зарядить патрон (MMB + RMB драг вниз) в первый раз - затвор закрывается (должно сразу заряжаться).\"\n\n## Root Cause\nThe bug was caused by **incorrect order of input processing** in `_Process()`:\n\n```csharp\n// BEFORE FIX (problematic order)\nHandleDragGestures();      // Checks _isMiddleMouseHeld (from PREVIOUS frame)\nHandleMiddleMouseButton(); // Updates _isMiddleMouseHeld (for CURRENT frame)\n```\n\nWhen the user pressed MMB on the **same frame** as starting the RMB drag, the MMB state wasn't updated yet when `HandleDragGestures()` checked it.\n\nAdditionally, `_wasMiddleMouseHeldDuringDrag` was unconditionally reset to `false` at drag start, losing information about MMB already being held.\n\n## Solution\n1. **Reorder input processing**: Call `HandleMiddleMouseButton()` BEFORE `HandleDragGestures()` so MMB state is up-to-date when checking\n2. **Initialize flag properly**: Set `_wasMiddleMouseHeldDuringDrag = _isMiddleMouseHeld` at drag start (instead of `false`)\n3. **Add diagnostic logging**: Added `VerboseInputLogging` flag (off by default) for debugging\n\n## Files Changed\n- `Scripts/Weapons/Shotgun.cs` - Fixed input processing order and MMB tracking logic\n- `docs/case-studies/issue-213/` - Case study documentation with detailed analysis\n\n## Test Plan\n- [ ] Start tutorial level with shotgun equipped\n- [ ] Fire some shells to create space in tube magazine\n- [ ] Open bolt (RMB drag UP)\n- [ ] **Immediately** try to load a shell (MMB + RMB drag DOWN)\n- [ ] Verify shell is loaded (not bolt closed)\n- [ ] Repeat multiple times with varying timing\n- [ ] Verify subsequent shell loading also works\n- [ ] Close bolt and verify normal operation\n\nFixes #213\n\n---\nGenerated with [Claude Code](https://claude.com/claude-code)","commits":[{"authoredDate":"2026-01-22T05:32:58Z","authors":[{"email":"drakonard@gmail.com","id":"MDQ6VXNlcjE0MzE5MDQ=","login":"konard","name":"konard"}],"committedDate":"2026-01-22T05:32:58Z","messageBody":"Adding CLAUDE.md with task information for AI processing.\nThis file will be removed when the task is complete.\n\nIssue: https://github.com/Jhon-Crow/godot-topdown-MVP/issues/213","messageHeadline":"Initial commit with task details","oid":"32998068c86caa3a3a308ca01108e6473a00e0e8"},{"authoredDate":"2026-01-22T05:38:02Z","authors":[{"email":"drakonard@gmail.com","id":"MDQ6VXNlcjE0MzE5MDQ=","login":"konard","name":"konard"},{"email":"noreply@anthropic.com","id":"MDQ6VXNlcjgxODQ3","login":"claude","name":"Claude Opus 4.5"}],"committedDate":"2026-01-22T05:38:02Z","messageBody":"The bug caused the bolt to close (instead of loading a shell) on the first\nMMB + RMB drag down attempt after opening the bolt.\n\nRoot cause: Incorrect order of input processing in _Process():\n- HandleDragGestures() was called BEFORE HandleMiddleMouseButton()\n- This meant _isMiddleMouseHeld was still from the previous frame when checked\n- If user pressed MMB on the same frame as RMB drag start, it was missed\n\nFix:\n1. Reorder _Process() to call HandleMiddleMouseButton() before HandleDragGestures()\n2. Initialize _wasMiddleMouseHeldDuringDrag based on current MMB state at drag start\n   (instead of unconditionally resetting to false)\n3. Add VerboseInputLogging flag for debugging similar issues in the future\n\nAlso adds case study documentation in docs/case-studies/issue-213/\n\nFixes #213\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>","messageHeadline":"Fix shotgun reload input timing - first shell load attempt now works","oid":"309eae2a5327aabe339ec632edb484a0bd41fa05"},{"authoredDate":"2026-01-22T05:40:29Z","authors":[{"email":"drakonard@gmail.com","id":"MDQ6VXNlcjE0MzE5MDQ=","login":"konard","name":"konard"}],"committedDate":"2026-01-22T05:40:29Z","messageBody":"This reverts commit 32998068c86caa3a3a308ca01108e6473a00e0e8.","messageHeadline":"Revert \"Initial commit with task details\"","oid":"78ecb5f28c76a96c6583f3dae22b22d42f4077ce"}],"files":[{"path":"Scripts/Weapons/Shotgun.cs","additions":25,"deletions":5},{"path":"docs/case-studies/issue-213/README.md","additions":136,"deletions":0},{"path":"docs/case-studies/issue-213/game_log_20260122_082656.txt","additions":174,"deletions":0},{"path":"docs/case-studies/issue-213/game_log_20260122_082906.txt","additions":106,"deletions":0}],"mergedAt":"2026-01-22T05:45:08Z","title":"Fix shotgun reload input timing - first shell load attempt now works"}
